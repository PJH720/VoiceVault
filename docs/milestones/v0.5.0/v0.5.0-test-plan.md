# VoiceVault v0.5.0 — Test Plan

> Date: 2026-02-25
> Scope: Obsidian Plugin, Frontend (Next.js), Backend (FastAPI), E2E

---

## 1. Test Strategy Overview

| Layer | Framework | Coverage Target | Status |
|-------|-----------|----------------|--------|
| Plugin (TS) | `tsc --noEmit` + esbuild build | Type safety | Active |
| Frontend (Next.js) | Vitest + Testing Library | Components + hooks | Active |
| Backend (Python) | pytest (asyncio_mode=auto) | Services + API routes | Active |
| E2E | Playwright | Critical user flows | Planned |

---

## 2. Test Environment

- **Database**: In-memory SQLite (`sqlite+aiosqlite:///:memory:`)
- **LLM**: `AsyncMock(spec=BaseLLM)` — no real API calls
- **STT**: Mocked — no Whisper model required
- **ChromaDB**: In-memory (ephemeral client)
- **Obsidian API**: Mocked via jest/vitest mocks

---

## 3. Backend Tests (pytest)

### 3.1 Unit Tests (`tests/unit/`)

| Test File | Scope |
|-----------|-------|
| `test_obsidian_export.py` | Export pipeline, frontmatter, wikilinks, VaultAdapter |
| `test_plugin_auth.py` | PluginAuthMiddleware: key validation, skip paths |
| `test_summarizer.py` | Minute/hour summarization |
| `test_rag.py` | RAG retriever, similarity search |
| `test_classifier.py` | Zero-shot classification |
| `test_template_matcher.py` | Template matching logic |

### 3.2 Integration Tests (`tests/integration/`)

| Test File | Scope |
|-----------|-------|
| `test_recording_api.py` | Recording CRUD lifecycle |
| `test_summary_api.py` | Summary generation pipeline |
| `test_pipeline.py` | WebSocket → transcript → summary pipeline |

### 3.3 E2E Tests (`tests/e2e/`)

| Test File | Scope |
|-----------|-------|
| `test_full_pipeline.py` | Record → transcribe → summarize → classify → export |

### Test Execution

```bash
# All tests
PYTHONPATH=backend uv run python -m pytest tests/ -v --ignore=tests/stress

# Unit only
PYTHONPATH=backend uv run python -m pytest tests/unit/ -v

# Export-related
PYTHONPATH=backend uv run python -m pytest tests/ -k "export" -v
```

---

## 4. Frontend Tests (Vitest)

### 4.1 Component Tests

- UI components: Button, Card, Spinner, EmptyState, ErrorState
- Page components: RAG Search, Export, Summaries

### 4.2 Hook Tests

- `useRAGSearch`: mutation lifecycle, error handling
- `useRecordings`: query + filter logic

### 4.3 API Client Tests

- `apiClient`: timeout, error parsing, status code handling
- `ragApi`, `exportApi`: correct endpoint paths

### Test Execution

```bash
cd frontend && pnpm test         # Run all
cd frontend && pnpm test:watch   # Watch mode
```

---

## 5. Plugin Tests

### 5.1 Type Safety

```bash
cd plugin && npx tsc --noEmit
```

### 5.2 Build Verification

```bash
cd plugin && npm run build
```

### 5.3 Manual Testing Checklist

- [ ] Plugin loads in Obsidian without errors
- [ ] Settings tab displays all options
- [ ] Connection test button works (backend running)
- [ ] Ribbon icon reflects connection state
- [ ] RAG Search command appears in Command Palette

---

## 6. E2E Tests (Playwright)

### Critical Flows

1. **Recording → Summaries**: Start recording → see real-time transcripts → stop → view summaries
2. **RAG Search**: Enter query → see answer + sources → click source link
3. **Export**: Select recordings → configure options → export → download .md

### Test Execution

```bash
cd frontend && pnpm test:e2e
```

---

## 7. CI Integration

All tests run in GitHub Actions CI (`.github/workflows/ci.yml`):

- Backend: `lint` → `test` → `security`
- Frontend: `frontend-lint` → `frontend-test` → `frontend-build`
- Plugin: `plugin-check` (type-check + build)
- Contract: `api-contract-check` (OpenAPI schema freshness)
