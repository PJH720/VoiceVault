# VoiceVault v0.5.0 — Performance Benchmark

> Date: 2026-02-25
> Environment: Apple M-series / Linux x86_64, Python 3.12, Node 22

---

## 1. Performance Targets

| Operation | Target | Priority |
|-----------|--------|----------|
| RAG query (end-to-end) | < 5 seconds | P0 |
| Markdown export (single) | < 3 seconds | P0 |
| Plugin load (Obsidian) | < 1 second | P0 |
| Health check round-trip | < 200ms | P1 |
| Frontend page load (FCP) | < 2 seconds | P1 |
| Minute summarization | < 10 seconds | P1 |
| Hour integration summary | < 15 seconds | P2 |

---

## 2. Benchmark Methods

### 2.1 RAG Query Performance

```bash
# Using curl with timing
time curl -s -X POST http://localhost:8000/api/v1/rag/query \
  -H "Content-Type: application/json" \
  -d '{"query": "What was discussed about AI?", "top_k": 5}' \
  -o /dev/null -w "%{time_total}s"
```

**Components measured**:
- Embedding generation: ~200-500ms (local sentence-transformers)
- ChromaDB similarity search: ~50-100ms (in-process, no network)
- LLM answer generation: ~2-4s (Ollama local, model-dependent)

### 2.2 Export Performance

```bash
# Single recording export
time curl -s -X POST http://localhost:8000/api/v1/recordings/1/export \
  -H "Content-Type: application/json" \
  -d '{"include_transcript": true}' \
  -o /dev/null -w "%{time_total}s"
```

**Components measured**:
- DB queries (recording + summaries + classifications): ~50ms
- Frontmatter generation: ~5ms
- Body rendering: ~10ms
- Wikilinks (RAG similarity): ~500ms (if enabled)
- File I/O: ~10ms

### 2.3 Plugin Load Time

Measured via Obsidian Developer Console:

```
console.time('VoiceVault:load');
// ... plugin onload()
console.timeEnd('VoiceVault:load');
```

**Components**:
- `loadData()` (settings): ~10ms
- Health check (initial): ~100-200ms (network dependent)
- UI setup (ribbon, commands, settings tab): ~5ms

### 2.4 Frontend Performance

```bash
# Lighthouse CI (programmatic)
cd frontend && pnpm build
npx lighthouse http://localhost:3000 --output json --chrome-flags="--headless"
```

---

## 3. Current Estimates

> Note: Actual measurements pending full integration testing.

| Operation | Estimated | Target | Status |
|-----------|-----------|--------|--------|
| RAG query (Ollama llama3.2) | ~3-4s | < 5s | Likely pass |
| RAG query (Claude API) | ~2-3s | < 5s | Likely pass |
| Export (single, no wikilinks) | ~200ms | < 3s | Pass |
| Export (single, with wikilinks) | ~1-2s | < 3s | Likely pass |
| Export (batch, 10 recordings) | ~5-15s | N/A | Acceptable |
| Plugin load | ~300ms | < 1s | Pass |
| Health check | ~50ms | < 200ms | Pass |
| FCP (Next.js production) | ~500ms | < 2s | Pass |

---

## 4. Bottleneck Analysis

### 4.1 Primary Bottleneck: LLM Inference

- **Ollama (local)**: 2-5s per generation depending on model size
- **Claude API**: 1-3s per request, subject to rate limits (5 req/min free tier)
- **Mitigation**: 1-minute summary token budget (< 50 tokens), async pipeline

### 4.2 Secondary Bottleneck: Embedding Generation

- **sentence-transformers (local)**: ~200-500ms per embedding
- **Ollama embedding**: ~100-300ms per embedding
- **Mitigation**: Batch embedding on export, cached in ChromaDB

### 4.3 Frontend Bundle Size

- Next.js 16 with tree-shaking: target < 200KB initial JS
- React Query for cache deduplication
- No heavy UI libraries (Tailwind CSS is compile-time)

---

## 5. Optimization Recommendations

### Immediate (v0.5.0)

1. **Connection pooling**: Reuse SQLAlchemy session pool (already configured)
2. **ChromaDB in-process**: No network overhead (already configured)
3. **Export caching**: Cache wikilinks similarity results for repeated exports

### Future (v0.6.0+)

1. **Streaming RAG responses**: Server-sent events for progressive answer display
2. **Background export queue**: Celery/ARQ for batch exports
3. **Embedding cache**: Redis/SQLite cache for repeated queries
4. **CDN for frontend**: Static assets on Cloudflare/Vercel edge

---

## 6. Benchmark Script

```bash
#!/bin/bash
# scripts/benchmark.sh — Run performance benchmarks

echo "=== Health Check ==="
time curl -sf http://localhost:8000/api/v1/health > /dev/null

echo ""
echo "=== RAG Query ==="
time curl -sf -X POST http://localhost:8000/api/v1/rag/query \
  -H "Content-Type: application/json" \
  -d '{"query": "test query", "top_k": 3}' > /dev/null

echo ""
echo "=== Export (ID=1) ==="
time curl -sf -X POST http://localhost:8000/api/v1/recordings/1/export \
  -H "Content-Type: application/json" \
  -d '{"include_transcript": false}' > /dev/null
```
